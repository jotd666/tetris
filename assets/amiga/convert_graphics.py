# temporary stand-in tiles with wrong palette

from PIL import Image
import os

import bitplanelib

this_dir = os.path.abspath(os.path.dirname(__file__))
src_dir = os.path.join(this_dir,"../../src/amiga")

default_palette = """0,0,0,255
0,0,0,255
182,0,0,255
0,0,85,255
255,109,0,255
0,0,170,255
0,0,255,255
73,73,170,255
146,109,170,255
73,0,85,255
0,36,255,255
146,0,0,255
109,0,0,255
0,73,255,255
219,146,170,255
0,109,255,255
255,255,255,255
0,146,255,255
182,0,0,255
255,0,0,255
255,109,0,255
0,36,0,255
0,0,170,255
73,73,170,255
146,109,170,255
73,0,85,255
219,219,255,255
146,0,0,255
109,0,0,255
73,0,0,255
219,146,170,255
146,182,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,0,0,255
0,36,0,255
73,0,85,255
0,0,85,255
0,0,170,255
0,0,255,255
0,36,255,255
0,73,255,255
0,109,255,255
0,146,255,255
146,182,255,255
219,219,255,255
255,255,255,255
219,146,170,255
255,109,0,255
73,73,170,255
0,0,0,255
0,146,255,255
182,0,0,255
255,0,0,255
255,109,0,255
0,36,0,255
0,0,170,255
73,73,170,255
146,109,170,255
73,0,85,255
255,219,170,255
146,0,0,255
109,0,0,255
73,0,0,255
219,146,170,255
255,146,0,255
0,0,0,255
0,146,0,255
255,0,0,255
146,146,170,255
255,146,255,255
255,146,255,255
255,146,255,255
255,146,255,255
255,146,255,255
255,146,255,255
255,146,255,255
73,73,85,255
36,36,85,255
0,0,85,255
0,146,0,255
0,146,0,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,146,255,255
0,0,0,255
255,0,0,255
0,0,0,255
0,0,0,255
0,73,85,255
0,109,0,255
73,182,0,255
146,219,85,255
182,255,170,255
219,219,255,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
0,255,0,255
0,0,0,255
73,73,255,255
0,0,0,255
0,0,0,255
0,0,85,255
0,36,170,255
0,73,255,255
73,146,255,255
182,182,255,255
219,219,255,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,255,255
0,0,0,255
255,255,255,255
0,0,255,255
255,0,0,255
109,109,85,255
146,146,0,255
219,182,0,255
219,219,85,255
255,255,170,255
219,219,255,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
255,255,0,255
0,0,0,255
219,0,0,255
0,0,0,255
0,0,0,255
73,0,170,255
146,0,170,255
219,0,255,255
255,73,255,255
219,146,255,255
219,219,255,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
255,0,255,255
0,0,0,255
73,73,255,255
0,0,0,255
0,0,0,255
0,73,170,255
0,146,170,255
0,182,170,255
73,219,255,255
182,219,255,255
219,219,255,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
0,182,255,255
0,0,0,255
182,0,0,255
0,0,0,255
0,0,0,255
73,36,85,255
182,109,0,255
255,146,0,255
255,182,85,255
255,219,170,255
255,255,255,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
146,109,0,255
0,0,0,255
0,0,170,255
0,0,0,255
0,0,0,255
36,36,85,255
73,73,85,255
146,146,170,255
182,182,170,255
182,182,255,255
219,219,255,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
0,0,0,255
""".splitlines()

# 63 unique colors for default
tiles_palette = [tuple(int(y) for y in x.split(",")[:3]) for x in default_palette]

with open(os.path.join(src_dir,"palette.68k"),"w") as f:
    bitplanelib.palette_dump(tiles_palette,f,bitplanelib.PALETTE_FORMAT_ASMGNU)

tiles = Image.open(os.path.join(this_dir,"..","tiles.png"))

tile_list = []
for y in range(0,tiles.size[1],8):
    for x in range(0,tiles.size[0],8):
        tile = Image.new("RGB",(8,8))
        tile.paste(tiles,(-x,-y))
        tile_list.append(tile)

character_codes_list = []
for k,img in enumerate(tile_list):
    local_palette = tiles_palette

    character_codes = bitplanelib.palette_image2raw(img,None,local_palette)
    character_codes_list.append(character_codes)

with open(os.path.join(src_dir,"graphics.68k"),"w") as f:
    f.write("\t.global\tcharacter_table\n")


    f.write("character_table:\n")
    for i,c in enumerate(character_codes_list):
        f.write(f"\t.long\tchar_{i}\n")

    for i,c in enumerate(character_codes_list):
        f.write(f"char_{i}:\n")
        # this is a table
        for j in range(16):
            j = 0 # TEMP
            f.write(f"\t.word\tchar_{i}_{j}-char_{i}\n")

        f.write(f"char_{i}_{j}:")
        bitplanelib.dump_asm_bytes(c,f,mit_format=True)

